# é§¿æ²³å±‹çˆ¬èŸ²èƒŒæ™¯æ’ç¨‹æœå‹™

## ğŸ“‹ åŠŸèƒ½èªªæ˜

æœ¬å°ˆæ¡ˆå·²æ–°å¢é§¿æ²³å±‹çˆ¬èŸ²çš„èƒŒæ™¯æ’ç¨‹æœå‹™ï¼Œå¯ä»¥è‡ªå‹•åœ¨æŒ‡å®šæ™‚é–“åŸ·è¡Œçˆ¬èŸ²ä»»å‹™ï¼Œæ¯ 6 å°æ™‚æ›´æ–°ä¸€æ¬¡å•†å“è³‡è¨Šã€‚

## â° é è¨­æ’ç¨‹æ™‚é–“

- **ç”Ÿç”¢ç’°å¢ƒ** (Production)ï¼šæ¯å¤© 00:00, 06:00, 12:00, 18:00
- **é–‹ç™¼ç’°å¢ƒ** (Development)ï¼šæ¯å¤© 09:00, 15:00 (æ¸¬è©¦ç”¨ï¼Œé–“éš”è¼ƒçŸ­)

## ğŸ› ï¸ é…ç½®è¨­å®š

### appsettings.json é…ç½®

```json
{
  "SurugayaScraper": {
    "Enabled": true,
    "ScheduledTimes": [
      "00:00",
      "06:00", 
      "12:00",
      "18:00"
    ],
    "ErrorRetryIntervalMinutes": 5,
    "TimeoutMinutes": 60
  }
}
```

### é…ç½®åƒæ•¸èªªæ˜

- `Enabled`: æ˜¯å¦å•Ÿç”¨èƒŒæ™¯æ’ç¨‹ (true/false)
- `ScheduledTimes`: åŸ·è¡Œæ™‚é–“é™£åˆ— (24å°æ™‚åˆ¶ï¼Œæ ¼å¼: HH:mm)
- `ErrorRetryIntervalMinutes`: éŒ¯èª¤é‡è©¦é–“éš” (åˆ†é˜)
- `TimeoutMinutes`: åŸ·è¡Œè¶…æ™‚æ™‚é–“ (åˆ†é˜)

## ğŸš€ éƒ¨ç½²èªªæ˜

### ä½¿ç”¨ Docker éƒ¨ç½²

1. **å»ºç½®æ˜ åƒ**
   ```bash
   docker build -t surugaya-api:latest .
   ```

2. **ä½¿ç”¨ Docker Compose å•Ÿå‹•**
   ```bash
   docker-compose up -d
   ```

3. **æª¢æŸ¥æœå‹™ç‹€æ…‹**
   ```bash
   docker-compose logs surugaya-api
   ```

### ç›´æ¥åŸ·è¡Œ

1. **å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼**
   ```bash
   dotnet run --project Surugaya.API
   ```

2. **èƒŒæ™¯æœå‹™æœƒè‡ªå‹•å•Ÿå‹•ä¸¦é¡¯ç¤ºæ—¥èªŒ**

## ğŸ“¡ API ç«¯é»

### çˆ¬èŸ²ç®¡ç†

- **GET** `/api/scrapermanagement/status` - æŸ¥çœ‹æ’ç¨‹ç‹€æ…‹
- **POST** `/api/scrapermanagement/execute` - æ‰‹å‹•åŸ·è¡Œå®Œæ•´çˆ¬èŸ²
- **POST** `/api/scrapermanagement/execute-single?url={url}` - åŸ·è¡Œå–®å€‹å•†å“çˆ¬èŸ²

### å¥åº·æª¢æŸ¥

- **GET** `/api/health` - æœå‹™å¥åº·æª¢æŸ¥

## ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒ

### æ—¥èªŒè¨Šæ¯ç¯„ä¾‹

```
[2024-11-17 00:00:00] é§¿æ²³å±‹çˆ¬èŸ²èƒŒæ™¯æœå‹™å·²å•Ÿå‹•ï¼Œæ’ç¨‹æ™‚é–“: 00:00, 06:00, 12:00, 18:00
[2024-11-17 00:00:01] é–‹å§‹åŸ·è¡Œé§¿æ²³å±‹çˆ¬èŸ²ä»»å‹™ - 2024-11-17 00:00:01
[2024-11-17 00:05:23] é§¿æ²³å±‹çˆ¬èŸ²ä»»å‹™å®Œæˆ - è™•ç†äº† 150 å€‹å•†å“ï¼Œè€—æ™‚: 00:05:22
[2024-11-17 00:05:23] ä¸‹æ¬¡åŸ·è¡Œæ™‚é–“: 2024-11-17 06:00:00, ç­‰å¾…æ™‚é–“: 05:54:37
```

### æŸ¥çœ‹æ’ç¨‹ç‹€æ…‹

**è«‹æ±‚**
```bash
curl -X GET "http://localhost:5000/api/scrapermanagement/status"
```

**å›æ‡‰ç¯„ä¾‹**
```json
{
  "enabled": true,
  "scheduledTimes": ["00:00", "06:00", "12:00", "18:00"],
  "errorRetryIntervalMinutes": 5,
  "timeoutMinutes": 60,
  "currentTime": "2024-11-17 14:30:25",
  "nextScheduledTime": "2024-11-17 18:00:00",
  "timeUntilNext": "03:29:35"
}
```

### æ‰‹å‹•åŸ·è¡Œçˆ¬èŸ²

**è«‹æ±‚**
```bash
curl -X POST "http://localhost:5000/api/scrapermanagement/execute"
```

**å›æ‡‰ç¯„ä¾‹**
```json
{
  "success": true,
  "message": "çˆ¬èŸ²ä»»å‹™åŸ·è¡Œå®Œæˆ",
  "processedCount": 150,
  "duration": "00:05:22",
  "startTime": "2024-11-17 14:30:00",
  "endTime": "2024-11-17 14:35:22"
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **èƒŒæ™¯æœå‹™æœªå•Ÿå‹•**
   - æª¢æŸ¥ `appsettings.json` ä¸­çš„ `Enabled` è¨­å®š
   - æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ—¥èªŒ

2. **çˆ¬èŸ²åŸ·è¡Œå¤±æ•—**
   - æª¢æŸ¥ç¶²è·¯é€£ç·š
   - ç¢ºèªé§¿æ²³å±‹ç¶²ç«™æ˜¯å¦æ­£å¸¸
   - æŸ¥çœ‹è©³ç´°éŒ¯èª¤æ—¥èªŒ

3. **æ’ç¨‹æ™‚é–“ä¸æ­£ç¢º**
   - ç¢ºèªæ™‚å€è¨­å®š
   - æª¢æŸ¥ `ScheduledTimes` æ ¼å¼æ˜¯å¦æ­£ç¢º (HH:mm)

### æ—¥èªŒç´šåˆ¥è¨­å®š

åœ¨ `appsettings.json` ä¸­èª¿æ•´æ—¥èªŒç´šåˆ¥ï¼š

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Surugaya.API.Services.SurugayaScraperBackgroundService": "Debug"
    }
  }
}
```

## ğŸ“ˆ æ•ˆèƒ½èª¿å„ª

### å»ºè­°è¨­å®š

- **ç”Ÿç”¢ç’°å¢ƒ**: è¶…æ™‚æ™‚é–“è¨­ç‚º 60 åˆ†é˜
- **é–‹ç™¼ç’°å¢ƒ**: è¶…æ™‚æ™‚é–“è¨­ç‚º 30 åˆ†é˜
- **éŒ¯èª¤é‡è©¦é–“éš”**: 5 åˆ†é˜ (é¿å…é »ç¹é‡è©¦)

### è³‡æºç›£æ§

- ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨é‡
- è§€å¯Ÿ CPU ä½¿ç”¨ç‡
- æª¢æŸ¥ç¶²è·¯è«‹æ±‚é »ç‡

## ğŸ” å®‰å…¨æ€§è€ƒé‡

- ç¢ºä¿ API ç«¯é»æœ‰é©ç•¶çš„æˆæ¬Šæ§åˆ¶
- é™åˆ¶æ‰‹å‹•åŸ·è¡Œçˆ¬èŸ²çš„é »ç‡
- ç›£æ§ç•°å¸¸çš„è«‹æ±‚æ¨¡å¼
